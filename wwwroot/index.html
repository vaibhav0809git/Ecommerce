<!DOCTYPE html>
<html>
<head>
    <title>Mini Flipkart</title>
    <style>
        body {
            margin: 0;
            font-family: Arial;
            background: #f1f3f6;
        }

        header {
            background: #2874f0;
            color: white;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
        }

        .search-box input {
            width: 400px;
            padding: 7px;
            border: none;
        }

        .icons span {
            margin-left: 20px;
            cursor: pointer;
        }

        .container {
            padding: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .price {
            color: green;
            font-weight: bold;
        }

        button {
            background: #ff9f00;
            border: none;
            padding: 7px 12px;
            color: white;
            cursor: pointer;
            margin-top: 8px;
        }

        .sidebar {
            position: fixed;
            right: -350px;
            top: 0;
            width: 350px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
            transition: 0.3s;
            padding: 15px;
            overflow: auto;
        }

            .sidebar.open {
                right: 0;
            }

            .sidebar h3 {
                margin-top: 0;
            }

        .navbar {
            background: white;
            padding: 10px;
            display: flex;
            gap: 20px;
        }

            .navbar button {
                background: #2874f0;
            }
    </style>
</head>

<body>

    <header>
        <div class="logo">Flipkart Clone</div>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="searchProduct()" />
        </div>

        <div class="icons">
            <span onclick="toggleCart()">🛒 Cart</span>
            <span onclick="showAccount()">👤 Account</span>
            <span onclick="showAddProduct()">➕ Add</span>
        </div>
    </header>

    <div class="navbar">
        <button onclick="loadProducts()">Home</button>
        <button onclick="showAccount()">Account</button>
        <button onclick="showAddProduct()">Add Product</button>
    </div>

    <div class="container">
        <div id="productGrid" class="grid"></div>
    </div>

    <!-- CART SIDEBAR -->
    <div id="cartSidebar" class="sidebar">
        <h3>🛒 Cart</h3>
        <div id="cartItems"></div>
        <hr>
        <p><b>Total: ₹<span id="total">0</span></b></p>
        <button onclick="placeOrder()">Place Order</button>
    </div>

    <!-- ACCOUNT -->
    <div id="accountPage" style="display:none; padding:20px;">
        <h2>👤 Account / Settings</h2>
        <p>User: Demo User</p>
        <p>Email: demo@mail.com</p>
    </div>

    <!-- ADD PRODUCT -->
    <div id="addProductPage" style="display:none; padding:20px;">
        <h2>Add Product</h2>
        <input id="name" placeholder="Name"><br><br>
        <input id="desc" placeholder="Description"><br><br>
        <input id="price" placeholder="Price"><br><br>
        <input id="stock" placeholder="Stock"><br><br>
        <button onclick="addProduct()">Add Product</button>
    </div>

    <script>
        const apiBase = "https://localhost:7137/api";
        let cart = [];

        loadProducts();

        function loadProducts() {
            fetch(apiBase + "/Product")
                .then(r => r.json())
                .then(showProducts);
        }

        function showProducts(products) {
            document.getElementById("accountPage").style.display = "none";
            document.getElementById("addProductPage").style.display = "none";

            let grid = document.getElementById("productGrid");
            grid.innerHTML = "";

            products.forEach(p => {
                let card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                <h4>${p.name}</h4>
                <p>${p.description}</p>
                <p class="price">₹${p.price}</p>
                <button onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
            `;
                grid.appendChild(card);
            });
        }

        function searchProduct() {
            let text = document.getElementById("searchInput").value;

            fetch(apiBase + "/Product/search?name=" + text)
                .then(r => r.json())
                .then(showProducts);
        }

        function addToCart(p) {
            cart.push(p);
            renderCart();
        }

        function toggleCart() {
            document.getElementById("cartSidebar").classList.toggle("open");
        }

        function renderCart() {
            let list = document.getElementById("cartItems");
            list.innerHTML = "";
            let total = 0;

            cart.forEach(i => {
                total += i.price;
                let d = document.createElement("div");
                d.innerText = i.name + " - ₹" + i.price;
                list.appendChild(d);
            });

            document.getElementById("total").innerText = total;
        }

        function placeOrder() {
            if (cart.length === 0) return alert("Cart empty");

            let total = cart.reduce((s, i) => s + i.price, 0);

            fetch(apiBase + "/Order", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId: 1, totalAmount: total })
            }).then(() => {
                alert("Order placed!");
                cart = [];
                renderCart();
            });
        }

        function showAccount() {
            document.getElementById("accountPage").style.display = "block";
            document.getElementById("addProductPage").style.display = "none";
        }

        function showAddProduct() {
            document.getElementById("accountPage").style.display = "none";
            document.getElementById("addProductPage").style.display = "block";
        }

        function addProduct() {
            fetch(apiBase + "/Product", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: document.getElementById("name").value,
                    description: document.getElementById("desc").value,
                    price: parseFloat(document.getElementById("price").value),
                    stock: parseInt(document.getElementById("stock").value)
                })
            }).then(() => {
                alert("Product Added");
                loadProducts();
            });
        }
    </script>

</body>
</html>
